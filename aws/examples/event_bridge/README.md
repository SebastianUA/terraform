# Work with EVENT_BRIDGE via terraform

A terraform module for making EVENT_BRIDGE.


## Usage
----------------------
Import the module and retrieve with ```terraform get``` or ```terraform get --update```. Adding a module resource to your template, e.g. `main.tf`:

```
#
# MAINTAINER Vitaliy Natarov "vitaliy.natarov@yahoo.com"
#
terraform {
  required_version = "~> 1.0"
}

provider "aws" {
  region                  = "us-east-1"
  shared_credentials_file = pathexpand("~/.aws/credentials")
}

module "event_bridge" {
  source = "../../modules/event_bridge"

  enable_cloudwatch_event_rule      = true
  cloudwatch_event_rule_name        = "test-cw-rule"
  cloudwatch_event_rule_name_prefix = null
  cloudwatch_event_rule_description = "test"

  cloudwatch_event_rule_event_pattern = jsonencode({
    detail-type = [
      "AWS Console Sign In via CloudTrail"
    ]
  })

  tags = tomap({
    "Environment"   = "dev",
    "Createdby"     = "Vitaliy Natarov",
    "Orchestration" = "Terraform"
  })
}

```

## Module Input Variables
----------------------
- `name` - Name to be used on all resources as prefix (`default = TEST`)
- `environment` - Environment for service (`default = STAGE`)
- `tags` - Add additional tags (`default = {}`)
- `enable_cloudwatch_event_rule` - Enable cloudwatch event rule usage (`default = False`)
- `cloudwatch_event_rule_name` - (Optional) The name of the rule. If omitted, Terraform will assign a random, unique name. Conflicts with name_prefix (`default = null`)
- `cloudwatch_event_rule_name_prefix` - (Optional) Creates a unique name beginning with the specified prefix. Conflicts with name. Note: Due to the length of the generated suffix, must be 38 characters or less. (`default = null`)
- `cloudwatch_event_rule_description` - (Optional) The description of the rule. (`default = null`)
- `cloudwatch_event_rule_schedule_expression` - (Optional) The scheduling expression. For example, cron(0 20 * * ? *) or rate(5 minutes). At least one of schedule_expression or event_pattern is required. Can only be used on the default event bus. For more information, refer to the AWS documentation Schedule Expressions for Rules. (`default = null`)
- `cloudwatch_event_rule_event_bus_name` - (Optional) The name or ARN of the event bus to associate with this rule. If you omit this, the default event bus is used. (`default = null`)
- `cloudwatch_event_rule_event_pattern` - (Optional) The event pattern described a JSON object. At least one of schedule_expression or event_pattern is required. See full documentation of Events and Event Patterns in EventBridge for details. (`default = null`)
- `cloudwatch_event_rule_role_arn` - (Optional) The Amazon Resource Name (ARN) associated with the role that is used for target invocation. (`default = null`)
- `cloudwatch_event_rule_is_enabled` - (Optional) Whether the rule should be enabled (defaults to true). (`default = null`)
- `enable_cloudwatch_event_permission` - Enable cloudwatch event permission usage (`default = False`)
- `cloudwatch_event_permission_principal` - Required) The 12-digit AWS account ID that you are permitting to put events to your default event bus. Specify * to permit any account to put events to your default event bus, optionally limited by condition. (`default = null`)
- `cloudwatch_event_permission_statement_id` - (Required) An identifier string for the external account that you are granting permissions to. (`default = null`)
- `cloudwatch_event_permission_action` - (Optional) The action that you are enabling the other account to perform. Defaults to events:PutEvents. (`default = null`)
- `cloudwatch_event_permission_event_bus_name` - (Optional) The name of the event bus to set the permissions on. If you omit this, the permissions are set on the default event bus. (`default = null`)
- `cloudwatch_event_permission_condition` - (Optional) Configuration block to limit the event bus permissions you are granting to only accounts that fulfill the condition (`default = []`)
- `enable_cloudwatch_event_api_destination` - Enable cloudwatch event api destination usage (`default = False`)
- `cloudwatch_event_api_destination_name` - (Required) The name of the new API Destination. The name must be unique for your account. Maximum of 64 characters consisting of numbers, lower/upper case letters, .,-,_. (`default = ""`)
- `cloudwatch_event_api_destination_invocation_endpoint` - (Required) URL endpoint to invoke as a target. This could be a valid endpoint generated by a partner service. You can include " * " as path parameters wildcards to be set from the Target HttpParameters. (`default = null`)
- `cloudwatch_event_api_destination_http_method` - (Required) Select the HTTP method used for the invocation endpoint, such as GET, POST, PUT, etc. (`default = null`)
- `cloudwatch_event_api_destination_connection_arn` - (Required) ARN of the EventBridge Connection to use for the API Destination. (`default = null`)
- `cloudwatch_event_api_destination_description` - (Optional) The description of the new API Destination. Maximum of 512 characters. (`default = null`)
- `cloudwatch_event_api_destination_invocation_rate_limit_per_second` - (Optional) Enter the maximum number of invocations per second to allow for this destination. Enter a value greater than 0 (default 300). (`default = null`)
- `enable_cloudwatch_event_archive` - Enable cloudwatch event archive usage (`default = False`)
- `cloudwatch_event_archive_name` - The name of the new event archive. The archive name cannot exceed 48 characters. (`default = ""`)
- `cloudwatch_event_archive_event_source_arn` - (Required) Event bus source ARN from where these events should be archived. (`default = null`)
- `cloudwatch_event_archive_description` - (Optional) The description of the new event archive. (`default = null`)
- `cloudwatch_event_archive_event_pattern` - (Optional) Instructs the new event archive to only capture events matched by this pattern. By default, it attempts to archive every event received in the event_source_arn. (`default = null`)
- `cloudwatch_event_archive_retention_days` - (Optional) The maximum number of days to retain events in the new event archive. By default, it archives indefinitely. (`default = null`)
- `enable_cloudwatch_event_bus_policy` - Enable cloudwatch event bus policy usage (`default = False`)
- `cloudwatch_event_bus_policy_policy` - (Required) The text of the policy. For more information about building AWS IAM policy documents with Terraform, see the AWS IAM Policy Document Guide. (`default = null`)
- `cloudwatch_event_bus_policy_event_bus_name` - (Optional) The name of the event bus to set the permissions on. If you omit this, the permissions are set on the default event bus. (`default = null`)
- `enable_cloudwatch_event_bus` - Enable cloudwatch event bus usage (`default = False`)
- `cloudwatch_event_bus_name` - The name of the new event bus. The names of custom event buses can't contain the / character. To create a partner event bus, ensure the name matches the event_source_name. (`default = ""`)
- `cloudwatch_event_bus_event_source_name` - (Optional) The partner event source that the new event bus will be matched with. Must match name. (`default = null`)
- `enable_cloudwatch_event_target` - Enable cloudwatch event target usage (`default = False`)
- `cloudwatch_event_target_rule` - (Required) The name of the rule you want to add targets to. (`default = ""`)
- `cloudwatch_event_target_arn` - Required) The Amazon Resource Name (ARN) of the target. (`default = null`)
- `cloudwatch_event_target_event_bus_name` - (Optional) The name or ARN of the event bus to associate with the rule. If you omit this, the default event bus is used. (`default = null`)
- `cloudwatch_event_target_input` - (Optional) Valid JSON text passed to the target. Conflicts with input_path and input_transformer. (`default = null`)
- `cloudwatch_event_target_input_path` - (Optional) The value of the JSONPath that is used for extracting part of the matched event when passing it to the target. Conflicts with input and input_transformer. (`default = null`)
- `cloudwatch_event_target_input_transformer` - (Optional) Parameters used when you are providing a custom input to a target based on certain event data. Conflicts with input and input_path (`default = null`)
- `cloudwatch_event_target_role_arn` - (Optional) The Amazon Resource Name (ARN) of the IAM role to be used for this target when the rule is triggered. Required if ecs_target is used or target in arn is EC2 instance, Kinesis data stream, Step Functions state machine, or Event Bus in different account or region. (`default = null`)
- `cloudwatch_event_target_target_id` - (Optional) The unique target assignment ID. If missing, will generate a random, unique id. (`default = null`)
- `cloudwatch_event_target_batch_target` - (Optional) Parameters used when you are using the rule to invoke an Amazon Batch Job (`default = {}`)
- `cloudwatch_event_target_dead_letter_config` - (Optional) Parameters used when you are providing a dead letter config. A maximum of 1 are allowed. (`default = {}`)
- `cloudwatch_event_target_ecs_target` - (Optional) Parameters used when you are using the rule to invoke Amazon ECS Task. A maximum of 1 are allowed. (`default = {}`)
- `cloudwatch_event_target_http_target` - (Optional) Parameters used when you are using the rule to invoke an API Gateway REST endpoint. A maximum of 1 is allowed. (`default = {}`)
- `cloudwatch_event_target_kinesis_target` - (Optional) Parameters used when you are using the rule to invoke an Amazon Kinesis Stream. A maximum of 1 are allowed. (`default = {}`)
- `cloudwatch_event_target_run_command_targets` - (Optional) Parameters used when you are using the rule to invoke Amazon EC2 Run Command. A maximum of 5 are allowed. (`default = []`)
- `cloudwatch_event_target_redshift_target` - (Optional) Parameters used when you are using the rule to invoke an Amazon Redshift Statement. A maximum of 1 are allowed. (`default = {}`)
- `cloudwatch_event_target_retry_policy` - (Optional) Parameters used when you are providing retry policies. A maximum of 1 are allowed. (`default = {}`)
- `cloudwatch_event_target_sagemaker_pipeline_target` - (Optional) Parameters used when you are using the rule to invoke an Amazon SageMaker Pipeline. A maximum of 1 are allowed. (`default = {}`)
- `cloudwatch_event_target_sqs_target` - (Optional) Parameters used when you are using the rule to invoke an Amazon SQS Queue. A maximum of 1 are allowed. (`default = {}`)
- `enable_cloudwatch_event_endpoint` - Enable cloudwatch event endpoint usage (`default = False`)
- `cloudwatch_event_endpoint_description` - (Optional) A description of the global endpoint. (`default = null`)
- `cloudwatch_event_endpoint_role_arn` - (Optional) The ARN of the IAM role used for replication between event buses. (`default = null`)
- `cloudwatch_event_endpoint_event_bus` - (Required) The event buses to use. The names of the event buses must be identical in each Region. Exactly two event buses are required. (`default = {}`)
- `cloudwatch_event_endpoint_replication_config` - (Optional) Parameters used for replication (`default = {}`)
- `cloudwatch_event_endpoint_routing_config` - (Required) Parameters used for routing, including the health check and secondary Region (`default = {}`)
- `enable_cloudwatch_event_connection` - Enable cloudwatch event connection usage (`default = False`)
- `cloudwatch_event_connection_name` - The name of the new connection. Maximum of 64 characters consisting of numbers, lower/upper case letters, .,-,_. (`default = ""`)
- `cloudwatch_event_connection_authorization_type` - (Required) Choose the type of authorization to use for the connection. One of API_KEY,BASIC,OAUTH_CLIENT_CREDENTIALS. (`default = null`)
- `cloudwatch_event_connection_description` - (Optional) Enter a description for the connection. Maximum of 512 characters. (`default = null`)
- `cloudwatch_event_connection_invocation_http_parameters` - (Optional) Invocation Http Parameters are additional credentials used to sign each Invocation of the ApiDestination created from this Connection. If the ApiDestination Rule Target has additional HttpParameters, the values will be merged together, with the Connection Invocation Http Parameters taking precedence. Secret values are stored and managed by AWS Secrets Manager. A maximum of 1 are allowed. (`default = {}`)
- `cloudwatch_event_connection_auth_parameters` - (Required) Parameters used for authorization. A maximum of 1 are allowed (`default = {}`)

## Module Output Variables
----------------------
- `cloudwatch_event_rule_id` - The name of the rule.
- `cloudwatch_event_rule_arn` - The Amazon Resource Name (ARN) of the rule.
- `cloudwatch_event_permission_id` - The statement ID of the EventBridge permission.
- `cloudwatch_event_api_destination_id` - The ID of the event API Destination.
- `cloudwatch_event_api_destination_arn` - The Amazon Resource Name (ARN) of the event API Destination.
- `cloudwatch_event_archive_id` - The ID of the event archive.
- `cloudwatch_event_archive_arn` - The Amazon Resource Name (ARN) of the event archive.
- `cloudwatch_event_bus_policy_id` - The name of the EventBridge event bus policy.
- `cloudwatch_event_bus_id` - The ID of the EventBridge event bus.
- `cloudwatch_event_bus_arn` - The Amazon Resource Name (ARN) of the event bus.
- `cloudwatch_event_target_id` - The ID of the EventBridge event target.
- `cloudwatch_event_endpoint_id` - The ID of the EventBridge event endpoint.
- `cloudwatch_event_endpoint_arn` - The ARN of the endpoint that was created.
- `cloudwatch_event_endpoint_endpoint_url` - The URL of the endpoint that was created.
- `cloudwatch_event_connection_id` - The ID of the EventBridge event connection.
- `cloudwatch_event_connection_arn` - The Amazon Resource Name (ARN) of the connection.
- `cloudwatch_event_connection_secret_arn` - The Amazon Resource Name (ARN) of the secret created from the authorization parameters specified for the connection.


## Authors

Created and maintained by [Vitaliy Natarov](https://github.com/SebastianUA). An email: [vitaliy.natarov@yahoo.com](vitaliy.natarov@yahoo.com).

## License

Apache 2 Licensed. See [LICENSE](https://github.com/SebastianUA/terraform/blob/master/LICENSE) for full details.
